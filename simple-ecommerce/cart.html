<!DOCTYPE html>
<html>
<head>
    <title>Your Cart</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #f4f4f4; }
        /* Common Navigation Bar */
        .nav { background: #333; color: white; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; }
        .nav a { color: white; text-decoration: none; margin-left: 20px; font-weight: bold; }
        
        .container { padding: 40px; max-width: 650px; margin: auto; }
        .cart-box { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        .item { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 15px 0; 
            border-bottom: 1px solid #eee; 
        }
        
        /* Remove Button Style */
        .remove-btn { 
            background: #ff4d4d; 
            color: white; 
            border: none; 
            padding: 6px 12px; 
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 13px;
        }
        .remove-btn:hover { background: #cc0000; }
        
        .btn-order { background: #007bff; color: white; border: none; padding: 15px; width: 100%; border-radius: 8px; cursor: pointer; font-size: 18px; margin-top: 25px; }
        .btn-order:hover { background: #0056b3; }
        .empty-msg { text-align: center; color: #888; padding: 20px; }
    </style>
</head>
<body>
    <div class="nav">
        <strong>Simple E-Store</strong>
        <div>
            <a href="/store">Home</a>
            <a href="/cart">ðŸ›’ Cart</a>
            <a href="/" onclick="localStorage.clear()">Logout</a>
        </div>
    </div>

    <div class="container">
        <div class="cart-box">
            <h2>Your Shopping Cart</h2>
            <div id="cartItems"></div>
            
            <h3 style="text-align: right; margin-top: 20px;">Total: $<span id="totalPrice">0</span></h3>
            <button class="btn-order" onclick="placeOrder()">Confirm & Place Order</button>
        </div>
    </div>

    <script>
        function renderCart() {
            const cart = JSON.parse(localStorage.getItem('myCart')) || [];
            const container = document.getElementById('cartItems');
            let total = 0;
            
            if (cart.length === 0) {
                container.innerHTML = "<p class='empty-msg'>Your cart is empty. Start shopping!</p>";
                document.getElementById('totalPrice').innerText = "0";
                return;
            }

            container.innerHTML = "";
            cart.forEach((item, index) => {
                total += item.price;
                container.innerHTML += `
                    <div class="item">
                        <div>
                            <strong>${item.name}</strong><br>
                            <span style="color: #28a745;">$${item.price}</span>
                        </div>
                        <button class="remove-btn" onclick="removeItem(${index})">Remove</button>
                    </div>`;
            });
            document.getElementById('totalPrice').innerText = total;
        }

        // NEW: Function to delete an item
        function removeItem(index) {
            let cart = JSON.parse(localStorage.getItem('myCart')) || [];
            
            // Remove the item at the specific index
            cart.splice(index, 1);
            
            // Save the updated list back to memory
            localStorage.setItem('myCart', JSON.stringify(cart));
            
            // Refresh the page content
            renderCart();
        }

        async function placeOrder() {
            const cart = JSON.parse(localStorage.getItem('myCart')) || [];
            const email = localStorage.getItem('userEmail');
            
            if(cart.length === 0) return alert("Your cart is empty!");

            const res = await fetch('/api/orders', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ 
                    items: cart, 
                    totalPrice: parseInt(document.getElementById('totalPrice').innerText), 
                    userEmail: email 
                })
            });
            
            const result = await res.json();
            alert(result.message);
            localStorage.removeItem('myCart');
            window.location.href = "/store";
        }

        // Run this when page loads
        renderCart();
    </script>
</body>
</html>